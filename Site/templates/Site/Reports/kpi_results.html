{% extends 'Site/Reports/default.html' %}
    {% block breadcrumb %}
        <li class="breadcrumb-item active"><a href="{% url 'Site:Report' company_id %}">Report</a></li>
        <li class="breadcrumb-item active">Report - KPI Results</li>
    {% endblock %}
    {% block page_title %}Report - KPI Results{% endblock %}
    {% block content %}

        <div class="container-fluid">
            <div class="card card-danger">
                <div class="card-header">
                    <h3 class="card-title">Pie Chart</h3>
                </div>
                <div class="card-body row">
                    <div class="col-md-6">
                        <div class="chartjs-size-monitor">
                            <div class="chartjs-size-monitor-expand">
                                <div class=""></div>
                            </div>
                            <div class="chartjs-size-monitor-shrink">
                                <div class="">

                                </div>
                            </div>
                        </div>
                        <canvas id="piechart_category" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%; display: block; width: 486px;" width="486" height="250" class="chartjs-render-monitor"></canvas>
                    </div>
                    <div class="col-md-6">
                        <h2 class="text-center">Average score <strong>{{ average_score }}</strong></h2>
                        <table class="table table-bordered">
                            <thead>
                                <th>>75%/th>
                                <th>>= 50% < 75%</th>
                                <th>>= 25% < 50%</th>
                                <th><25%</th>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>{{ cat_75 }}</td>
                                    <td>{{ cat_50 }}</td>
                                    <td>{{ cat_25 }}</td>
                                    <td>{{ cat_0 }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

            </div>
            <div class="card">
                <div class="card-header">
                    <h5>Issues</h5>
                </div>
                <div style="overflow-x: scroll">
                    <table class="table table-bordered table-hover ExportTable table-striped">
                        <thead>
                        <tr>
                            <th>Staff</th>
                            <th>Member</th>
                            <th>Issue</th>
                        </tr>
                        </thead>
                        <tbody>
                            {% for member in member_error_list %}
                                <tr>
                                    <td>{{ member.0 }}</td>
                                    <td>{{ member.1 }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h5>My Members</h5>
                </div>
                <div style="overflow-x: scroll">
                    <button onclick="exportReportToExcel()">Export to excel</button>
                    <table class="table table-bordered table-hover ExportTable table-striped">
                      <thead>
                          <tr>
                            <th>Staff</th>
                            <th>KPI</th>
                            <th>Function</th>
                            <th>Type</th>
                            <th>Result</th>
                            <th>Apr</th>
                            <th>Apr approved</th>
                            <th>May</th>
                            <th>May Approved</th>
                            <th>Jun</th>
                            <th>Jun Approved</th>
                            <th>Jul</th>
                            <th>Jul Approved</th>
                            <th>Aug</th>
                            <th>Aug Approved</th>
                            <th>Sep</th>
                            <th>Sep Approved</th>
                            <th>Oct</th>
                            <th>Oct Approved</th>
                            <th>Nov</th>
                            <th>Nov Approved</th>
                            <th>Dec</th>
                            <th>Dec Approved</th>
                            <th>Jan</th>
                            <th>Jan Approved</th>
                            <th>Feb</th>
                            <th>Feb Approved</th>
                            <th>Mar</th>
                            <th>Mar Approved</th>
                            <th>Score</th>
                          </tr>
                      </thead>
                      <tbody>
                        {% for member in my_members_kpi_score %}
                            <tr>
                                {% if member.1|length < 1 %}
                                    <td>{{ member.0 }}</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>0</td>
                                    <td>0</td>

                                    </tr>
                                {% else %}
                                    <td rowspan="{{ member.1|length }}">{{ member.0 }}</td>
                                    <td>{{ member.1.0.0 }}</td>
                                    
                                    <td>{{ member.1.0.0.kpi_april_score }}</td>
                                    <td>{% if member.1.0.0.kpi_april_score_approve is False %}0{% else %}1{% endif %}</td>
                                    <td>{{ member.1.0.0.kpi_may_score }}</td>
                                    <td>{% if member.1.0.0.kpi_may_score_approve is False %}0{% else %}1{% endif %}</td>
                                    <td>{{ member.1.0.0.kpi_june_score }}</td>
                                    <td>{% if member.1.0.0.kpi_june_score_approve is False %}0{% else %}1{% endif %}</td>
                                    <td>{{ member.1.0.0.kpi_july_score }}</td>
                                    <td>{% if member.1.0.0.kpi_july_score_approve is False %}0{% else %}1{% endif %}</td>
                                    <td>{{ member.1.0.0.kpi_august_score }}</td>
                                    <td>{% if member.1.0.0.kpi_august_score_approve is False %}0{% else %}1{% endif %}</td>
                                    <td>{{ member.1.0.0.kpi_september_score }}</td>
                                    <td>{% if member.1.0.0.kpi_september_score_approve is False %}0{% else %}1{% endif %}</td>
                                    <td>{{ member.1.0.0.kpi_october_score }}</td>
                                    <td>{% if member.1.0.0.kpi_october_score_approve is False %}0{% else %}1{% endif %}</td>
                                    <td>{{ member.1.0.0.kpi_november_score }}</td>
                                    <td>{% if member.1.0.0.kpi_november_score_approve is False %}0{% else %}1{% endif %}</td>
                                    <td>{{ member.1.0.0.kpi_december_score }}</td>
                                    <td>{% if member.1.0.0.kpi_december_score_approve is False %}0{% else %}1{% endif %}</td>
                                    <td>{{ member.1.0.0.kpi_january_score }}</td>
                                    <td>{% if member.1.0.0.kpi_january_score_approve is False %}0{% else %}1{% endif %}</td>
                                    <td>{{ member.1.0.0.kpi_february_score }}</td>
                                    <td>{% if member.1.0.0.kpi_february_score_approve is False %}0{% else %}1{% endif %}</td>
                                    <td>{{ member.1.0.0.kpi_march_score }}</td>
                                    <td>{% if member.1.0.0.kpi_march_score_approve is False %}0{% else %}1{% endif %}</td>
                                    <td>{{ member.1.0.1 }}</td>
                                    <td rowspan="{{ member.1|length }}">{{ member.2 }}</td>
                                    </tr>
                                    {% for kpi in member.1 %}
                                        {% if kpi != member.1.0 %}
                                           <tr>
                                                <td>{{ kpi.0 }}</td>
                                                <td>{{ kpi.0.kpi_april_score }}</td>
                                                <td>{% if kpi.0.kpi_april_score_approve is False %}0{% else %}1{% endif %}</td>
                                                <td>{{ kpi.0.kpi_may_score }}</td>
                                                <td>{% if kpi.0.kpi_may_score_approve is False %}0{% else %}1{% endif %}</td>
                                                <td>{{ kpi.0.kpi_june_score }}</td>
                                                <td>{% if kpi.0.kpi_june_score_approve is False %}0{% else %}1{% endif %}</td>
                                                <td>{{ kpi.0.kpi_july_score }}</td>
                                                <td>{% if kpi.0.kpi_july_score_approve is False %}0{% else %}1{% endif %}</td>
                                                <td>{{ kpi.0.kpi_august_score }}</td>
                                                <td>{% if kpi.0.kpi_august_score_approve is False %}0{% else %}1{% endif %}</td>
                                                <td>{{ kpi.0.kpi_september_score }}</td>
                                                <td>{% if kpi.0.kpi_september_score_approve is False %}0{% else %}1{% endif %}</td>
                                                <td>{{ kpi.0.kpi_october_score }}</td>
                                                <td>{% if kpi.0.kpi_october_score_approve is False %}0{% else %}1{% endif %}</td>
                                                <td>{{ kpi.0.kpi_november_score }}</td>
                                                <td>{% if kpi.0.kpi_november_score_approve is False %}0{% else %}1{% endif %}</td>
                                                <td>{{ kpi.0.kpi_december_score }}</td>
                                                <td>{% if kpi.0.kpi_december_score_approve is False %}0{% else %}1{% endif %}</td>
                                                <td>{{ kpi.0.kpi_january_score }}</td>
                                                <td>{% if kpi.0.kpi_january_score_approve is False %}0{% else %}1{% endif %}</td>
                                                <td>{{ kpi.0.kpi_february_score }}</td>
                                                <td>{% if kpi.0.kpi_february_score_approve is False %}0{% else %}1{% endif %}</td>
                                                <td>{{ kpi.0.kpi_march_score }}</td>
                                                <td>{% if kpi.0.kpi_march_score_approve is False %}0{% else %}1{% endif %}</td>
                                                <td>{{ kpi.1 }}</td>
                                           </tr>
                                        {% endif %}
                                    {% endfor %}
                                {% endif %}
                            </tr>
                        {% endfor %}
                      </tbody>
                    </table>
                </div>
                <br>
            </div>
            {% if levels_down_kpi_score %}
                <div class="card">
                    <div class="card-header">
                        <h5>Level Down Members</h5>
                    </div>
                    <div style="overflow-x: scroll">
                        <button onclick="exportReportToExcel()">Export to excel</button>
                        <table class="table table-bordered table-hover ExportTable table-striped">
                          <thead>
                              <tr>
                                <th>Staff</th>
                                <th>KPI</th>
                                <th>Details</th>
                                <th>Apr</th>
                                <th>Apr approved</th>
                                <th>May</th>
                                <th>May Approved</th>
                                <th>Jun</th>
                                <th>Jun Approved</th>
                                <th>Jul</th>
                                <th>Jul Approved</th>
                                <th>Aug</th>
                                <th>Aug Approved</th>
                                <th>Sep</th>
                                <th>Sep Approved</th>
                                <th>Oct</th>
                                <th>Oct Approved</th>
                                <th>Nov</th>
                                <th>Nov Approved</th>
                                <th>Dec</th>
                                <th>Dec Approved</th>
                                <th>Jan</th>
                                <th>Jan Approved</th>
                                <th>Feb</th>
                                <th>Feb Approved</th>
                                <th>Mar</th>
                                <th>Mar Approved</th>
                                <th>KPI score</th>
                                <th>Overall Score</th>
                              </tr>
                          </thead>
                          <tbody>
                            {% for member in levels_down_kpi_score %}
                                <tr>
                                        <td rowspan="{{ member.1|length }}">{{ member.0 }}</td>
                                    {% if member.1|length < 1 %}
                                        <td>-</td>
                                        <td>-</td>
                                        <td>-</td>
                                        <td>-</td>
                                        <td>-</td>
                                        <td>-</td>
                                        <td>-</td>
                                        <td>-</td>
                                        <td>-</td>
                                        <td>-</td>
                                        <td>-</td>
                                        <td>-</td>
                                        <td>-</td>
                                        <td>-</td>
                                        <td>-</td>
                                        <td>-</td>
                                        <td>-</td>
                                        <td>-</td>
                                        <td>-</td>
                                        <td>-</td>
                                        <td>-</td>
                                        <td>-</td>
                                        <td>-</td>
                                        <td>-</td>
                                        <td>0</td>
                                        <td>0</td>
                                        </tr>
                                    {% else %}
                                        <td rowspan="{{ member.1|length }}">{{ member.0 }}</td>
                                        <td>{{ member.1.0.0 }}</td>

                                        <td>{{ member.1.0.0.kpi_april_score }}</td>
                                        <td>{% if member.1.0.0.kpi_april_score_approve is False %}0{% else %}1{% endif %}</td>
                                        <td>{{ member.1.0.0.kpi_may_score }}</td>
                                        <td>{% if member.1.0.0.kpi_may_score_approve is False %}0{% else %}1{% endif %}</td>
                                        <td>{{ member.1.0.0.kpi_june_score }}</td>
                                        <td>{% if member.1.0.0.kpi_june_score_approve is False %}0{% else %}1{% endif %}</td>
                                        <td>{{ member.1.0.0.kpi_july_score }}</td>
                                        <td>{% if member.1.0.0.kpi_july_score_approve is False %}0{% else %}1{% endif %}</td>
                                        <td>{{ member.1.0.0.kpi_august_score }}</td>
                                        <td>{% if member.1.0.0.kpi_august_score_approve is False %}0{% else %}1{% endif %}</td>
                                        <td>{{ member.1.0.0.kpi_september_score }}</td>
                                        <td>{% if member.1.0.0.kpi_september_score_approve is False %}0{% else %}1{% endif %}</td>
                                        <td>{{ member.1.0.0.kpi_october_score }}</td>
                                        <td>{% if member.1.0.0.kpi_october_score_approve is False %}0{% else %}1{% endif %}</td>
                                        <td>{{ member.1.0.0.kpi_november_score }}</td>
                                        <td>{% if member.1.0.0.kpi_november_score_approve is False %}0{% else %}1{% endif %}</td>
                                        <td>{{ member.1.0.0.kpi_december_score }}</td>
                                        <td>{% if member.1.0.0.kpi_december_score_approve is False %}0{% else %}1{% endif %}</td>
                                        <td>{{ member.1.0.0.kpi_january_score }}</td>
                                        <td>{% if member.1.0.0.kpi_january_score_approve is False %}0{% else %}1{% endif %}</td>
                                        <td>{{ member.1.0.0.kpi_february_score }}</td>
                                        <td>{% if member.1.0.0.kpi_february_score_approve is False %}0{% else %}1{% endif %}</td>
                                        <td>{{ member.1.0.0.kpi_march_score }}</td>
                                        <td>{% if member.1.0.0.kpi_march_score_approve is False %}0{% else %}1{% endif %}</td>
                                        <td>{{ member.1.0.1 }}</td>
                                        <td rowspan="{{ member.1|length }}">{{ member.2 }}</td>
                                        </tr>
                                        {% for kpi in member.1 %}
                                            {% if kpi != member.1.0 %}
                                               <tr>
                                                   <td>{{ kpi.0 }}</td>
                                                   <td>{{ kpi.0.kpi_april_score }}</td>
                                                   <td>{% if kpi.0.kpi_april_score_approve is False %}0{% else %}1{% endif %}</td>
                                                   <td>{{ kpi.0.kpi_may_score }}</td>
                                                   <td>{% if kpi.0.kpi_may_score_approve is False %}0{% else %}1{% endif %}</td>
                                                   <td>{{ kpi.0.kpi_june_score }}</td>
                                                   <td>{% if kpi.0.kpi_june_score_approve is False %}0{% else %}1{% endif %}</td>
                                                   <td>{{ kpi.0.kpi_july_score }}</td>
                                                   <td>{% if kpi.0.kpi_july_score_approve is False %}0{% else %}1{% endif %}</td>
                                                   <td>{{ kpi.0.kpi_august_score }}</td>
                                                   <td>{% if kpi.0.kpi_august_score_approve is False %}0{% else %}1{% endif %}</td>
                                                   <td>{{ kpi.0.kpi_september_score }}</td>
                                                   <td>{% if kpi.0.kpi_september_score_approve is False %}0{% else %}1{% endif %}</td>
                                                   <td>{{ kpi.0.kpi_october_score }}</td>
                                                   <td>{% if kpi.0.kpi_october_score_approve is False %}0{% else %}1{% endif %}</td>
                                                   <td>{{ kpi.0.kpi_november_score }}</td>
                                                   <td>{% if kpi.0.kpi_november_score_approve is False %}0{% else %}1{% endif %}</td>
                                                   <td>{{ kpi.0.kpi_december_score }}</td>
                                                   <td>{% if kpi.0.kpi_december_score_approve is False %}0{% else %}1{% endif %}</td>
                                                   <td>{{ kpi.0.kpi_january_score }}</td>
                                                   <td>{% if kpi.0.kpi_january_score_approve is False %}0{% else %}1{% endif %}</td>
                                                   <td>{{ kpi.0.kpi_february_score }}</td>
                                                   <td>{% if kpi.0.kpi_february_score_approve is False %}0{% else %}1{% endif %}</td>
                                                   <td>{{ kpi.0.kpi_march_score }}</td>
                                                   <td>{% if kpi.0.kpi_march_score_approve is False %}0{% else %}1{% endif %}</td>
                                                   <td>{{ kpi.1 }}</td>
                                               </tr>
                                            {% endif %}
                                        {% endfor %}
                                    {% endif %}
                                </tr>
                            {% endfor %}
                          </tbody>
                        </table>
                    </div>
                    <br>
                </div>
            {% endif %}
        </div>


    {% endblock %}